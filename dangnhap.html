<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÄÄƒng nháº­p SMEMBER</title>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>

  <body class="body-login">
    <div class="login-container">
      <div class="login-box">
        <!-- BÃªn trÃ¡i -->
        <div class="login-left">
          <h3>ÄÄƒng nháº­p tÃ i khoáº£n <span>PK Store</span></h3>
          <p class="text-muted">Äá»ƒ khÃ´ng bá» lá»¡ cÃ¡c Æ°u Ä‘Ã£i háº¥p dáº«n tá»« PK Store</p>

          <div class="benefit-box">
            <div class="benefit-item">
              <i class="bi bi-gift-fill"></i>
              <span><b>Chiáº¿t kháº¥u Ä‘áº¿n 5%</b> khi mua cÃ¡c sáº£n pháº©m táº¡i PK Store</span>
            </div>
            <div class="benefit-item">
              <i class="bi bi-truck"></i>
              <span><b>Miá»…n phÃ­ giao hÃ ng</b> cho thÃ nh viÃªn tá»« Ä‘Æ¡n 300.000Ä‘</span>
            </div>
            <div class="benefit-item">
              <i class="bi bi-cash-coin"></i>
              <span><b>Há»— trá»£ tráº£ gÃ³p 0%</b></span>
            </div>
            <div class="benefit-item">
              <i class="bi bi-award-fill"></i>
              <span><b>ThÄƒng háº¡ng nháº­n voucher Ä‘áº¿n 300.000Ä‘</b></span>
            </div>
          </div>
        </div>

        <!-- BÃªn pháº£i -->
        <div class="login-right">
          <h2>ÄÄƒng nháº­p tÃ i khoáº£n</h2>

          <div id="error-box" class="alert alert-danger d-none"></div>

          <form id="loginForm">
            <div class="mb-3">
              <label class="form-label">TÃªn Ä‘Äƒng nháº­p</label>
              <input type="text" class="form-control" id="username" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Máº­t kháº©u</label>
              <input type="password" class="form-control" id="password" required />
            </div>
            <button type="submit" class="btn btn-dangnhap w-100">ÄÄƒng nháº­p</button>
          </form>

          <div class="text-center mt-3">
            <a href="#" class="text-primary text-decoration-none">QuÃªn máº­t kháº©u?</a>
          </div>

          <div class="text-center my-3 text-muted">Hoáº·c Ä‘Äƒng nháº­p báº±ng</div>
          <div class="d-flex justify-content-between social-login">
            <button><img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png"> Google</button>
            <button><img src="https://cdn-icons-png.flaticon.com/512/5968/5968841.png"> Zalo</button>
          </div>

          <div class="text-center mt-4">
            Báº¡n chÆ°a cÃ³ tÃ i khoáº£n?
            <a href="dangky.html" class="text-danger fw-bold text-decoration-none">ÄÄƒng kÃ½ ngay</a>
          </div>
        </div>
      </div>
    </div>

    <!-- JS xá»­ lÃ½ Ä‘Äƒng nháº­p -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("loginForm");
        const errorBox = document.getElementById("error-box");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          errorBox.classList.add("d-none");

          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();

          if (!username || !password) {
            showError("âš ï¸ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!");
            return;
          }

          try {
            const res = await fetch("http://localhost:3000/api/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            const data = await res.json();

            if (res.ok) {
              // LÆ°u thÃ´ng tin user
              localStorage.setItem("user", JSON.stringify(data.user));

              // Kiá»ƒm tra quyá»n
              if (data.user.role === "admin") {
                alert("ğŸ‘‘ Xin chÃ o Admin!");
                window.location.href = "admin.html";
              } else {
                alert("ğŸ‰ ÄÄƒng nháº­p thÃ nh cÃ´ng!");
                window.location.href = "index.html";
              }
            } else {
              showError(data.error || "Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!");
            }
          } catch (err) {
            console.error(err);
            showError("âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i Ä‘áº¿n server!");
          }
        });

        function showError(msg) {
          errorBox.textContent = msg;
          errorBox.classList.remove("d-none");
        }
      });
    </script>
  </body>
</html>
