<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒêƒÉng k√Ω SMEMBER</title>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  <link rel="stylesheet" href="/../assets/css/style.css" />  
</head>

<body class="body-dangky">
  <div class="register-container">
    <h3 class="text-center fw-bold mb-4">ƒêƒÉng k√Ω b·∫±ng t√†i kho·∫£n m·∫°ng x√£ h·ªôi</h3>
    <div class="social-login">
      <button><img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" alt="Google"> Google</button>
      <button><img src="https://cdn-icons-png.flaticon.com/512/5968/5968841.png" alt="Zalo"> Zalo</button>
    </div>

    <div class="text-center mb-4 text-muted">Ho·∫∑c ƒëi·ªÅn th√¥ng tin sau</div>

    <!-- H·ªôp hi·ªÉn th·ªã l·ªói -->
    <div id="error-box" class="alert alert-danger text-center d-none"></div>
    <div id="success-box" class="alert alert-success text-center d-none"></div>

    <form id="registerForm">
      <h4>Th√¥ng tin c√° nh√¢n</h4>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="fullname" class="form-label">H·ªç v√† t√™n</label>
          <input type="text" class="form-control" id="fullname" name="fullname" placeholder="Nh·∫≠p h·ªç v√† t√™n" required>
        </div>
        <div class="col-md-6">
          <label for="birthday" class="form-label">Ng√†y sinh</label>
          <input type="date" class="form-control" id="birthday" name="birthday">
        </div>
        <div class="col-md-6">
          <label for="phone" class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
          <input type="text" class="form-control" id="phone" name="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label">Email <span class="text-muted">(Kh√¥ng b·∫Øt bu·ªôc)</span></label>
          <input type="email" class="form-control" id="email" name="email" placeholder="Nh·∫≠p email">
          <div class="text-success small mt-1">‚úì H√≥a ƒë∆°n VAT khi mua h√†ng s·∫Ω ƒë∆∞·ª£c g·ª≠i qua email n√†y</div>
        </div>
      </div>

      <h4 class="mt-4">T·∫°o m·∫≠t kh·∫©u</h4>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
          <input type="password" class="form-control" id="password" name="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c·ªßa b·∫°n" required>
          <div class="note"><i class="bi bi-info-circle"></i> M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±, c√≥ √≠t nh·∫•t 1 ch·ªØ s·ªë v√† 1 k√Ω t·ª± ch·ªØ.</div>
        </div>
        <div class="col-md-6">
          <label for="confirm-password" class="form-label">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
          <input type="password" class="form-control" id="confirm-password" name="confirm_password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u c·ªßa b·∫°n" required>
        </div>
      </div>

      <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="newsletter" name="newsletter">
        <label class="form-check-label" for="newsletter">ƒêƒÉng k√Ω nh·∫≠n tin khuy·∫øn m√£i t·ª´ PK Store</label>
      </div>

      <p class="terms mt-3">
        B·∫±ng vi·ªác ƒêƒÉng k√Ω, b·∫°n ƒë√£ ƒë·ªçc v√† ƒë·ªìng √Ω v·ªõi
        <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a> v√†
        <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a> c·ªßa PK Store.
      </p>

      <div class="footer-actions">
        <a href="dangnhap.html" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Quay l·∫°i ƒëƒÉng nh·∫≠p
        </a>
        <button type="submit" class="btn btn-dangky">Ho√†n t·∫•t ƒëƒÉng k√Ω</button>
      </div>
    </form>
  </div>

  <!-- JS x·ª≠ l√Ω ƒëƒÉng k√Ω -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("registerForm");
      const errorBox = document.getElementById("error-box");
      const successBox = document.getElementById("success-box");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorBox.classList.add("d-none");
        successBox.classList.add("d-none");

        const fullname = document.getElementById("fullname").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const confirm = document.getElementById("confirm-password").value.trim();

        if (!fullname || !password || !confirm) {
          showError("‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!");
          return;
        }

        if (password !== confirm) {
          showError("‚ö†Ô∏è M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√¥ng kh·ªõp!");
          return;
        }

        if (password.length < 6) {
          showError("‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
          return;
        }

        try {
          const res = await fetch("http://localhost:3000/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: fullname, email, password }),
          });

          const data = await res.json();
          if (res.ok) {
            showSuccess("üéâ ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y ƒëƒÉng nh·∫≠p.");
            setTimeout(() => (window.location.href = "dangnhap.html"), 1500);
          } else {
            showError(data.error || "‚ùå L·ªói kh√¥ng x√°c ƒë·ªãnh khi ƒëƒÉng k√Ω.");
          }
        } catch (err) {
          console.error(err);
          showError("‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c ƒë·∫øn server Node.js!");
        }
      });

      function showError(msg) {
        errorBox.textContent = msg;
        errorBox.classList.remove("d-none");
      }

      function showSuccess(msg) {
        successBox.textContent = msg;
        successBox.classList.remove("d-none");
      }
    });
  </script>
</body>
</html>
